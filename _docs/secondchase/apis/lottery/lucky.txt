
2020/6/18 下午4:56:07{"level":"info","msg":"开启订阅协程 No. 14","source":"proc.go:203:runtime.main","time":"2020-06-18T16:56:07+08:00"}
2020/6/18 下午4:56:07{"level":"info","msg":"开启订阅协程 No. 15","source":"proc.go:203:runtime.main","time":"2020-06-18T16:56:07+08:00"}
2020/6/18 下午4:56:07{"level":"info","msg":"sql/app/repository/prize_repo.go:221.234848msSELECT * FROM `mz_prize`  WHERE (prize_status=?) ORDER BY `sort`[1] 7","source":"scope.go:1045:gorm.(*Scope).trace","time":"2020-06-18T16:56:07+08:00"}
2020/6/18 下午4:56:07{"level":"debug","msg":"Lucky InitPrizeList 获取奖品list=[{ID:1 Name:特斯拉 Model3 ImageUrl:https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/model3.png ImageUrl2:https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/model3blue.png ImagePrizeUrl:https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/prize/model3prize.png PrizeStatus:1 Quantity:5 Level:1 Sort:1} {ID:5 Name:一套医用口罩 ImageUrl:https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/kouzhao.png ImageUrl2: ImagePrizeUrl:https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/prize/kouzhaoprize.png PrizeStatus:1 Quantity:0 Level:5 Sort:2} {ID:2 Name:iPhone 11 Pro ImageUrl:https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/iphone.png ImageUrl2: ImagePrizeUrl:https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/prize/iphoneprize.png PrizeStatus:1 Quantity:20 Level:2 Sort:3} {ID:7 Name:谢谢参与 ImageUrl:https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/henyihan.png ImageUrl2: ImagePrizeUrl: PrizeStatus:1 Quantity:0 Level:7 Sort:4} {ID:6 Name:再来一次 ImageUrl:https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/zailaiyici.png ImageUrl2: ImagePrizeUrl: PrizeStatus:1 Quantity:0 Level:6 Sort:5} {ID:3 Name:小米手环4 ImageUrl:https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/xiaomi.png ImageUrl2: ImagePrizeUrl:https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/prize/xiaomiprize.png PrizeStatus:1 Quantity:5 Level:3 Sort:6} {ID:4 Name:秒追定制礼盒 ImageUrl:https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/lihe.png ImageUrl2: ImagePrizeUrl:https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/prize/liheprize.png PrizeStatus:1 Quantity:0 Level:4 Sort:7}]","source":"main.go:46:main.main","time":"2020-06-18T16:56:07+08:00"}
2020/6/18 下午4:56:07{"level":"debug","msg":"Lucky InitPrizeList 获取奖品prizeInitList=map[1:{1 特斯拉 Model3 https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/model3.png https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/model3blue.png https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/prize/model3prize.png 1 5 1 1} 2:{2 iPhone 11 Pro https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/iphone.png  https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/prize/iphoneprize.png 1 20 2 3} 3:{3 小米手环4 https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/xiaomi.png  https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/prize/xiaomiprize.png 1 5 3 6} 4:{4 秒追定制礼盒 https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/lihe.png  https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/prize/liheprize.png 1 0 4 7} 5:{5 一套医用口罩 https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/kouzhao.png  https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/prize/kouzhaoprize.png 1 0 5 2} 6:{6 再来一次 https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/zailaiyici.png   1 0 6 5} 7:{7 谢谢参与 https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/henyihan.png   1 0 7 4}]","source":"main.go:46:main.main","time":"2020-06-18T16:56:07+08:00"}
2020/6/18 下午4:56:07{"level":"debug","msg":"Lucky InitPrizeList ------------------","source":"main.go:46:main.main","time":"2020-06-18T16:56:07+08:00"}
2020/6/18 下午4:56:07{"level":"debug","msg":"tsl={1 特斯拉 Model3 https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/model3.png https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/model3blue.png https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/prize/model3prize.png 1 5 1 1}","source":"main.go:46:main.main","time":"2020-06-18T16:56:07+08:00"}
2020/6/18 下午4:56:07{"level":"debug","msg":"iphone={2 iPhone 11 Pro https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/iphone.png  https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/prize/iphoneprize.png 1 20 2 3}","source":"main.go:46:main.main","time":"2020-06-18T16:56:07+08:00"}
2020/6/18 下午4:56:07{"level":"debug","msg":"miBand={3 小米手环4 https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/xiaomi.png  https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/prize/xiaomiprize.png 1 5 3 6}","source":"main.go:46:main.main","time":"2020-06-18T16:56:07+08:00"}
2020/6/18 下午4:56:07{"level":"debug","msg":"little={4 秒追定制礼盒 https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/lihe.png  https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/prize/liheprize.png 1 0 4 7}","source":"main.go:46:main.main","time":"2020-06-18T16:56:07+08:00"}
2020/6/18 下午4:56:07{"level":"debug","msg":"mask={5 一套医用口罩 https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/kouzhao.png  https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/prize/kouzhaoprize.png 1 0 5 2}","source":"main.go:46:main.main","time":"2020-06-18T16:56:07+08:00"}
2020/6/18 下午4:56:07{"level":"debug","msg":"again={6 再来一次 https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/zailaiyici.png   1 0 6 5}","source":"main.go:46:main.main","time":"2020-06-18T16:56:07+08:00"}
2020/6/18 下午4:56:07{"level":"debug","msg":"thank={7 谢谢参与 https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/henyihan.png   1 0 7 4}","source":"main.go:46:main.main","time":"2020-06-18T16:56:07+08:00"}
2020/6/18 下午4:56:07{"level":"debug","msg":"Lucky InitPrizeList ------------------","source":"main.go:46:main.main","time":"2020-06-18T16:56:07+08:00"}
2020/6/18 下午4:56:07{"level":"debug","msg":"HowMuch:1","source":"main.go:48:main.main","time":"2020-06-18T16:56:07+08:00"}



2020/6/12 下午6:23:17{"level":"debug","msg":"Lucky 收到请求消息. lotteryservice.lucky _INBOX.r2vIHvD3Oz9EUD53NQU9YB.e0526DBC {272 {} [] 0}","source":"value.go:460:reflect.Value.call","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"GetUserRemain from Redis userId=272 remain=1","source":"lucky.go:132:service.Lucky","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"SetLockLotteryUser 设置redis分布式锁key=lottery:lock:user:272 success","source":"lucky.go:150:service.Lucky","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"error","msg":"updatePowerAgainRemain 用户剩余抽奖次数不足","source":"asm_amd64.s:1357:runtime.goexit","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"CountDistinctUser len(userIds)=100000","source":"lottery_repo.go:77:repository.(*mzLotteryRepo).GetLotteryTotalUsers","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"CountUserJoinTimesByUserId userId=272 count=23","source":"lottery_repo.go:148:repository.(*mzLotteryRepo).GetUserJoin","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"CountWinPrizeByPrizeId prizeId=1 count=3","source":"lottery_repo.go:158:repository.(*mzLotteryRepo).CountWinPrize","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"CountWinPrizeByPrizeId prizeId=2 count=9","source":"lottery_repo.go:158:repository.(*mzLotteryRepo).CountWinPrize","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"CountUserGainTimesByUserId userId=272 count=0","source":"lottery_repo.go:153:repository.(*mzLotteryRepo).GetUserGain","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"Lucky 进入抽奖流程 userJoinTimes=23","source":"value.go:460:reflect.Value.call","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"Lucky 进入抽奖流程 userGainTimes=0","source":"value.go:460:reflect.Value.call","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"Lucky lucky branch userJoinTimes 小于 50 并且 userJoinTimes 大于 20 lucky","source":"value.go:460:reflect.Value.call","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"Lucky lucky tslCount=3 iphoneCount=9 totalUsers=100000 userId=272","source":"lucky.go:261:service.Lucky","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"GetPrizeStep from Redis key=lottery:step:iphone num=9","source":"lottery_repo.go:310:repository.(*mzLotteryRepo).LockTslOrIphone","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"IncrPrizeStep 成功 key=lottery:step:iphone num=1","source":"lottery_repo.go:333:repository.(*mzLotteryRepo).LockTslOrIphone","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"Lucky lucky branch13 prizeId=2","source":"lucky.go:261:service.Lucky","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"IsUserWinTslOrIphone 用户未中特斯拉或iPhone","source":"lucky.go:567:service.lucky","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"Lucky lucky prizeId=2","source":"lucky.go:261:service.Lucky","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"IsUserWinTslOrIphone 用户未中特斯拉或iPhone","source":"lucky.go:310:service.Lucky","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"Lucky 发奖 tslId 或 iphoneId 或 miBandId resp.Data.PrizeId=2","source":"value.go:460:reflect.Value.call","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"SetLockLotteryServerPrize 设置redis分布式锁key=lottery:lock:server:prize:2 success","source":"lucky.go:402:service.Lucky","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"CountWinPrizeByPrizeId prizeId=2 count=9","source":"lottery_repo.go:158:repository.(*mzLotteryRepo).CountWinPrize","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"Lucky 获取 特斯拉 iPhone 小米手环 写入用户奖品表成功","source":"value.go:460:reflect.Value.call","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"UnLockLotteryServerPrize 删除redis分布式锁key=lottery:lock:server:prize:2 success","source":"lucky.go:439:service.Lucky","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"UnLockLotteryUser 删除redis分布式锁key=lottery:lock:user:272 success","source":"lucky.go:439:service.Lucky","time":"2020-06-12T18:23:17+08:00"}
2020/6/12 下午6:23:17{"level":"debug","msg":"Lucky 消息处理完成. lotteryservice.lucky _INBOX.r2vIHvD3Oz9EUD53NQU9YB.e0526DBC {0 SUCCESS PrizeId:2 PrizeName:\"iPhone 11 Pro\" ImageUrl:\"https://secondschased.oss-cn-beijing.aliyuncs.com/lottery/iphone.png\"  {} [] 98}","source":"lucky.go:439:service.Lucky","time":"2020-06-12T18:23:17+08:00"}
