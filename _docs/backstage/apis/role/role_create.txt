
root
53eaca53fc3c87fa7a1c46022e0cedd4
{
	"name":"总行自有角色1",
	"desc":"总行自有角色1描述"
}
{
    "code": 20011,
    "msg": "权限不足"
}


{"level":"debug","msg":"sign before: POST127.0.0.1:9001/api/v1/role/create{\"desc\":\"总行自有角色1描述\",\"name\":\"总行自有角色1\"}1234567890com.obencn.backstage.c27d32c5-c878-470a-8a6f-107f7d3700dd","source":"head.go:116:middleware.Options","time":"2020-07-09T13:57:17+08:00"}
{"level":"debug","msg":"server sign: 53eaca53fc3c87fa7a1c46022e0cedd4, \tuser sign: 53eaca53fc3c87fa7a1c46022e0cedd4","source":"context.go:161:gin.(*Context).Next","time":"2020-07-09T13:57:17+08:00"}
{"level":"debug","msg":"request uri=/api/v1/role/create JWT 验证token","source":"context.go:161:gin.(*Context).Next","time":"2020-07-09T13:57:17+08:00"}
{"level":"debug","msg":"request token=eyJhbGciOiJIUzI1NiIsImN0eSI6IkpXVCIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzZWNvbmRjaGFzZS5nYXRld2F5Iiwic3ViIjoiQWNjZXNzVG9rZW4iLCJhdWQiOiJodHRwczovL2JhY2tzdGFnZS5vYmVuY24uY29tIiwiZXhwIjoxNTk0MzQ3OTY0LCJuYmYiOjE1OTQyNjEyNjQsImlhdCI6MTU5NDI2MTU2NCwianRpIjoiMzYxNjU3MzUtMTg1Yy00ZWE2LWJmOTEtMDE3NzMyZDdlODhhIiwidXNlcl9pZCI6MX0.jQxMrRP9xgH2Z1omALdPrDDLaW9K6xl84eBDnN3eUAU","source":"context.go:161:gin.(*Context).Next","time":"2020-07-09T13:57:17+08:00"}
{"level":"debug","msg":"request uri=/api/v1/role/create middleware Casbin 验证权限","source":"context.go:161:gin.(*Context).Next","time":"2020-07-09T13:57:17+08:00"}
{"level":"info","msg":"用户无此权限 userId=1 path=/api/v1/role/create method=POST","source":"context.go:161:gin.(*Context).Next","time":"2020-07-09T13:57:17+08:00"}
2020/07/09 13:57:17 Request: 1, /api/v1/role/create, POST ---> false



admin1
bc3be4208a3e048f8a8a5098c32756b6
{
	"name":"北京分行自有角色3",
	"desc":"北京分行自有角色3描述"
}
{
    "code": 0,
    "msg": "SUCCESS",
    "data": {
        "id": 15,
        "name": "北京分行自有角色3",
        "organization_id": 2,
        "creator_id": 2,
        "desc": "北京分行自有角色3描述",
        "created_at": "2020-07-09T13:52:26.4171125+08:00",
        "updated_at": "2020-07-09T13:52:26.4300518+08:00"
    }
}

{"level":"debug","msg":"sign before: POST127.0.0.1:9001/api/v1/role/create{\"desc\":\"北京分行自有角色3描述\",\"name\":\"北京分行自有角色3\"}1234567890com.obencn.backstage.c27d32c5-c878-470a-8a6f-107f7d3700dd","source":"head.go:116:middleware.Options","time":"2020-07-09T13:52:26+08:00"}
{"level":"debug","msg":"server sign: bc3be4208a3e048f8a8a5098c32756b6, \tuser sign: bc3be4208a3e048f8a8a5098c32756b6","source":"context.go:161:gin.(*Context).Next","time":"2020-07-09T13:52:26+08:00"}
{"level":"debug","msg":"request uri=/api/v1/role/create JWT 验证token","source":"context.go:161:gin.(*Context).Next","time":"2020-07-09T13:52:26+08:00"}
{"level":"debug","msg":"request token=eyJhbGciOiJIUzI1NiIsImN0eSI6IkpXVCIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzZWNvbmRjaGFzZS5nYXRld2F5Iiwic3ViIjoiQWNjZXNzVG9rZW4iLCJhdWQiOiJodHRwczovL2JhY2tzdGFnZS5vYmVuY24uY29tIiwiZXhwIjoxNTk0MzQ3OTA2LCJuYmYiOjE1OTQyNjEyMDYsImlhdCI6MTU5NDI2MTUwNiwianRpIjoiMTI5Nzk4YjYtOTI4ZS00MWY5LWFhYzgtNWU0ODRiODQ1MDZjIiwidXNlcl9pZCI6Mn0.a1h-A2yDckfPDjMDwpHcJFPiTn2z9D6wHUHKRSKuxow","source":"context.go:161:gin.(*Context).Next","time":"2020-07-09T13:52:26+08:00"}
{"level":"debug","msg":"request uri=/api/v1/role/create middleware Casbin 验证权限","source":"context.go:161:gin.(*Context).Next","time":"2020-07-09T13:52:26+08:00"}
{"level":"debug","msg":"roleService Create req={HttpModel:{Path:/api/v1/role/create Method:POST IP:127.0.0.1} Name:北京分行自有角色3 Desc:北京分行自有角色3描述}","source":"role.go:162:handler.(*roleHandler).Create.func1","time":"2020-07-09T13:52:26+08:00"}
2020/07/09 13:52:26 Request: 2, /api/v1/role/create, POST ---> true
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/user.go:24822.9657msSELECT * FROM `bs_user`  WHERE (id=?) ORDER BY `bs_user`.`id` ASC LIMIT 1[2] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-07-09T13:52:26+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/role.go:5825.9698msINSERT INTO `bs_role` (`name`,`organization_id`,`role_status`,`creator_id`,`desc`,`created_at`,`updated_at`) VALUES (?,?,?,?,?,?,?)[北京分行自有角色3 2 1 2 北京分行自有角色3描述 2020-07-09 13:52:26.4171125 +0800 CST m=+6.234842401 2020-07-09 13:52:26.4300518 +0800 CST m=+6.247781701] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-07-09T13:52:26+08:00"}
{"level":"debug","msg":"roleRepo Create role={ID:15 Name:北京分行自有角色3 OrganizationId:2 RoleStatus:1 CreatorId:2 Desc:北京分行自有角色3描述 CreatedAt:2020-07-09 13:52:26.4171125 +0800 CST m=+6.234842401 UpdatedAt:2020-07-09 13:52:26.4300518 +0800 CST m=+6.247781701}","source":"role.go:88:service.(*roleService).Create","time":"2020-07-09T13:52:26+08:00"}


mysql> select * from bs_role;
+----+---------------------------+-----------------+-------------+------------+---------------------------------+---------------------+---------------------+
| id | name                      | organization_id | role_status | creator_id | desc                            | created_at          | updated_at          |
+----+---------------------------+-----------------+-------------+------------+---------------------------------+---------------------+---------------------+
|  1 | 一级管理员                |               1 |           1 |          1 | 角色描述                        | 2020-05-12 15:45:15 | 2020-07-09 11:34:41 |
|  2 | 二级管理员                |               1 |           1 |          1 | 角色描述                        | 2020-05-12 15:45:37 | 2020-07-09 11:34:41 |
|  3 | 运营                      |               0 |           1 |          1 | 角色描述                        | 2020-05-14 18:19:46 | 2020-07-09 11:57:45 |
|  4 | 审核                      |               0 |           1 |          1 | 角色描述                        | 2020-05-15 11:32:28 | 2020-07-09 11:57:47 |
|  5 | 北京分行自有角色1         |               2 |           1 |          2 | 角色描述                        | 2020-05-15 11:33:37 | 2020-07-09 11:23:01 |
|  6 | 北京分行自有角色2         |               2 |           1 |          2 | 角色描述                        | 2020-05-15 13:41:58 | 2020-07-09 11:23:01 |
| 15 | 北京分行自有角色3         |               2 |           1 |          2 | 北京分行自有角色3描述           | 2020-07-09 13:52:26 | 2020-07-09 13:52:26 |
+----+---------------------------+-----------------+-------------+------------+---------------------------------+---------------------+---------------------+
7 rows in set (0.00 sec)
mysql>




> use backstage
switched to db backstage
>
>
> show tables
operate_log
verify_code
>
>
> db.operate_log.find().sort({_id:-1}).limit(1).pretty()
{
	"_id" : ObjectId("5f06b09a6adcd67e1cf09b11"),
	"user_id" : 2,
	"real_name" : "北京分行行长",
	"organization_id" : 2,
	"department_id" : 1,
	"operate" : "新增角色:北京分行自有角色3",
	"path" : "/api/v1/role/create",
	"method" : "POST",
	"ip" : "127.0.0.1",
	"hazard_level" : 0,
	"created_at" : "2020-07-09T13:52:26+08:00"
}
>
