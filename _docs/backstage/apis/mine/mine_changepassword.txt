
mysql> select * from bs_user where id=13;
+----+------------------------------------------+-----------+---------------------+-------------+-------------+------------+-----------------+---------------+----------+---------------------+---------------------+
| id | password                                 | real_name | email               | phone       | user_status | creator_id | organization_id | department_id | desc     | created_at          | updated_at          |
+----+------------------------------------------+-----------+---------------------+-------------+-------------+------------+-----------------+---------------+----------+---------------------+---------------------+
| 13 | 05f581227d10eac0d6c25d41252c5f1625613bf8 | 姓名12    | 18813141886@163.com | 18813141012 |           1 |          1 |               2 |             1 | 用户12   | 2020-06-16 16:12:01 | 2020-06-28 11:23:40 |
+----+------------------------------------------+-----------+---------------------+-------------+-------------+------------+-----------------+---------------+----------+---------------------+---------------------+
1 row in set (0.00 sec)
mysql>



443eb40779016a30d8b0d767b1e00d5f
{
    "new_password":"abc123",
    "confirm_password":"abc1234"
}
{
    "code": 20118,
    "msg": "用户修改密码错误; 新密码和确认密码不一致"
}

9e1f662f3f4594250777876fa4bde431
{
    "new_password":"abcd1234",
    "confirm_password":"abcd1234"
}
{
    "code": 0,
    "msg": "SUCCESS"
}

{"level":"debug","msg":"sign before: POST127.0.0.1:3000/api/v1/mine/changepassword{\"confirm_password\":\"abc1234\",\"new_password\":\"abc1234\"}1234567890com.obencn.secondchase.3671e28d-e384-49e6-9cea-4d8cb80288d4","source":"head.go:116:middleware.Options","time":"2020-06-19T10:58:25+08:00"}
{"level":"debug","msg":"server sign: 9e1f662f3f4594250777876fa4bde431, \tuser sign: 9e1f662f3f4594250777876fa4bde431","source":"context.go:161:gin.(*Context).Next","time":"2020-06-19T10:58:25+08:00"}
{"level":"debug","msg":"request uri=/api/v1/mine/changepassword JWT 验证token","source":"context.go:161:gin.(*Context).Next","time":"2020-06-19T10:58:25+08:00"}
{"level":"debug","msg":"request token=eyJhbGciOiJIUzI1NiIsImN0eSI6IkpXVCIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzZWNvbmRjaGFzZS5nYXRld2F5Iiwic3ViIjoiQWNjZXNzVG9rZW4iLCJhdWQiOiJodHRwczovL2JhY2tzdGFnZS5vYmVuY24uY29tIiwiZXhwIjoxNTkyNjIxNTUzLCJuYmYiOjE1OTI1MzQ4NTMsImlhdCI6MTU5MjUzNTE1MywianRpIjoiYjdlMWQyMDctODVhZi00MjlkLWFjMjYtZjZkMzdhNDQzMzM1IiwidXNlcl9pZCI6MTN9.NfKYb9brtNxlzYuzW6SL-0-4yC9DWk48si0ASODTgHI","source":"context.go:161:gin.(*Context).Next","time":"2020-06-19T10:58:25+08:00"}
{"level":"debug","msg":"request uri=/api/v1/mine/changepassword middleware Casbin 不验证权限","source":"context.go:161:gin.(*Context).Next","time":"2020-06-19T10:58:25+08:00"}
{"level":"debug","msg":"mineService ChangePassword req={NewPassword:abc1234 ConfirmPassword:abc1234}","source":"mine.go:253:handler.(*mineHandler).ChangePassword.func1","time":"2020-06-19T10:58:25+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/user.go:20523.2115msSELECT * FROM `bs_user`  WHERE (id=?) ORDER BY `bs_user`.`id` ASC LIMIT 1[13] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-06-19T10:58:25+08:00"}
{"level":"debug","msg":"userRepo UpdatePassword user={ID:13 Password:51f22a1d702815e72b593ca36de88a9c9999e57a RealName:姓名12 Email:18813141886@163.com Phone:18813141012 UserStatus:1 CreatorId:1 OrganizationId:0 DepartmentId:0 Desc:用户12 CreatedAt:2020-06-16 16:12:01 +0800 CST UpdatedAt:2020-06-18 14:47:28 +0800 CST}","source":"mine.go:247:service.(*mineService).ChangePassword","time":"2020-06-19T10:58:25+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/user.go:21419.7972msUPDATE `bs_user` SET `password` = ?, `real_name` = ?, `email` = ?, `phone` = ?, `user_status` = ?, `creator_id` = ?, `organization_id` = ?, `department_id` = ?, `desc` = ?, `created_at` = ?, `updated_at` = ?  WHERE `bs_user`.`id` = ?[05f581227d10eac0d6c25d41252c5f1625613bf8 姓名12 18813141886@163.com 18813141012 1 1 0 0 用户12 2020-06-16 16:12:01 +0800 CST 2020-06-19 10:58:25.8764872 +0800 CST m=+649.358936501 13] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-06-19T10:58:25+08:00"}

mysql>
mysql> select * from bs_user where id=13;
+----+------------------------------------------+-----------+---------------------+-------------+-------------+------------+-----------------+---------------+----------+---------------------+---------------------+
| id | password                                 | real_name | email               | phone       | user_status | creator_id | organization_id | department_id | desc     | created_at          | updated_at          |
+----+------------------------------------------+-----------+---------------------+-------------+-------------+------------+-----------------+---------------+----------+---------------------+---------------------+
| 13 | aa94aec5ade8d2c3a6cf81761ed587736b68c77c | 姓名12    | 18813141886@163.com | 18813141012 |           1 |          1 |               2 |             1 | 用户12   | 2020-06-16 16:12:01 | 2020-06-28 15:57:51 |
+----+------------------------------------------+-----------+---------------------+-------------+-------------+------------+-----------------+---------------+----------+---------------------+---------------------+
1 row in set (0.01 sec)
mysql>

[登录]
22bfce1bdb80b1f0906d45185b049381
{
	"account_no":"18813141012",
	"password":"abc1234"
}
{
    "code": 20105,
    "msg": "密码错误; 18813141012"
}


2133ba468ce80b738b3ce228a041ae11
{
	"account_no":"18813141012",
	"password":"abcd1234"
}
{
    "code": 0,
    "msg": "SUCCESS",
    "data": {
        "access_token": "eyJhbGciOiJIUzI1NiIsImN0eSI6IkpXVCIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzZWNvbmRjaGFzZS5nYXRld2F5Iiwic3ViIjoiQWNjZXNzVG9rZW4iLCJhdWQiOiJodHRwczovL2JhY2tzdGFnZS5vYmVuY24uY29tIiwiZXhwIjoxNTkzNDE3NjQ1LCJuYmYiOjE1OTMzMzA5NDUsImlhdCI6MTU5MzMzMTI0NSwianRpIjoiODllOGQxNWMtNGZhYS00NDFlLTljZTktMmU1MjUyMjNmOGFjIiwidXNlcl9pZCI6MTN9.ZfnXoh4Wb3N2WqqpdNFIQwfQThFZ2V1WjD1THIqZNI8",
        "refresh_token": "eyJhbGciOiJIUzI1NiIsImN0eSI6IkpXVCIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJiYWNrc3RhZ2UuZ2F0ZXdheSIsInN1YiI6IlJlZnJlc2hUb2tlbiIsImF1ZCI6Imh0dHBzOi8vYmFja3N0YWdlLm9iZW5jbi5jb20iLCJleHAiOjE1OTU5MjMyNDUsIm5iZiI6MTU5MzMzMDk0NSwiaWF0IjoxNTkzMzMxMjQ1LCJqdGkiOiJmMzE0MGU3ZC1lMGFlLTQ3ZTYtODg2NC1iNTRkMzhiYWZkZTciLCJ1c2VyX2lkIjoxM30.zwqHKkeZ6TGOwGuwdt2OyDjgX2G7TlTj1723BNPvt1g",
        "user_info": {
            "id": 13,
            "real_name": "姓名12",
            "email": "18813141886@163.com",
            "phone": "18813141012",
            "creator_id": 1,
            "organization_id": 2,
            "department_id": 1,
            "org_name": "北京分行",
            "dep_name": "信用卡部",
            "desc": "用户12",
            "created_at": "2020-06-16T16:12:01+08:00",
            "updated_at": "2020-06-28T15:57:51+08:00"
        }
    }
}