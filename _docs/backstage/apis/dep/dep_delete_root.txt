
mysql> show tables;
+---------------------+
| Tables_in_backstage |
+---------------------+
| bs_department       |
| bs_organization     |
| bs_permission       |
| bs_role             |
| bs_role_permission  |
| bs_user             |
| bs_user_role        |
+---------------------+
7 rows in set (0.00 sec)
mysql>

select * from bs_role_permission where role_id=2;
update bs_role_permission set permission_id=4 where id=16;


mysql> select * from bs_role_permission where role_id=2;
+----+---------+---------------+--------+------------+---------------------+---------------------+
| id | role_id | permission_id | status | creator_id | created_at          | updated_at          |
+----+---------+---------------+--------+------------+---------------------+---------------------+
| 16 |       2 |             4 |      1 |          1 | 2020-05-15 15:04:23 | 2020-07-03 18:18:59 |
| 15 |       2 |            15 |      1 |          1 | 2020-05-15 15:04:13 | 2020-05-29 11:45:21 |
| 17 |       2 |            17 |      1 |          1 | 2020-05-15 15:10:56 | 2020-05-29 11:45:21 |
| 18 |       2 |            18 |      1 |          1 | 2020-05-15 15:11:10 | 2020-05-29 11:45:21 |
| 19 |       2 |            19 |      1 |          1 | 2020-05-15 17:40:13 | 2020-05-29 11:45:21 |
| 20 |       2 |            20 |      1 |          1 | 2020-05-15 17:40:13 | 2020-05-29 11:45:21 |
| 21 |       2 |            21 |      1 |          1 | 2020-05-15 17:45:11 | 2020-05-29 11:45:21 |
+----+---------+---------------+--------+------------+---------------------+---------------------+
7 rows in set (0.00 sec)
mysql>


select * from bs_user where id<=2;

mysql> select * from bs_user where id<=2;
+----+------------------------------------------+--------------+-----------------+-------------+-------------+------------+-----------------+---------------+-------------------+---------------------+---------------------+
| id | password                                 | real_name    | email           | phone       | user_status | creator_id | organization_id | department_id | desc              | created_at          | updated_at          |
+----+------------------------------------------+--------------+-----------------+-------------+-------------+------------+-----------------+---------------+-------------------+---------------------+---------------------+
|  1 | 51f22a1d702815e72b593ca36de88a9c9999e57a | 总行行长     | root@email.com  | 18813141001 |           1 |          0 |               1 |             0 | 系统管理员        | 2020-05-12 14:58:40 | 2020-07-02 18:07:05 |
|  2 | 51f22a1d702815e72b593ca36de88a9c9999e57a | 姓名2        | user1@email.com | 18813141002 |           1 |          1 |               0 |             1 | 部门1管理员1      | 2020-05-12 15:04:14 | 2020-06-16 16:12:49 |
+----+------------------------------------------+--------------+-----------------+-------------+-------------+------------+-----------------+---------------+-------------------+---------------------+---------------------+
2 rows in set (0.00 sec)
mysql>


update bs_user set real_name='北京分行行长', creator_id=1, organization_id=2 where id=2;


mysql> select * from bs_user where id<=2;
+----+------------------------------------------+--------------------+-----------------+-------------+-------------+------------+-----------------+---------------+-------------------+---------------------+---------------------+
| id | password                                 | real_name          | email           | phone       | user_status | creator_id | organization_id | department_id | desc              | created_at          | updated_at          |
+----+------------------------------------------+--------------------+-----------------+-------------+-------------+------------+-----------------+---------------+-------------------+---------------------+---------------------+
|  1 | 51f22a1d702815e72b593ca36de88a9c9999e57a | 总行行长           | root@email.com  | 18813141001 |           1 |          0 |               1 |             0 | 系统管理员        | 2020-05-12 14:58:40 | 2020-07-02 18:07:05 |
|  2 | 51f22a1d702815e72b593ca36de88a9c9999e57a | 北京分行行长       | user1@email.com | 18813141002 |           1 |          1 |               2 |             1 | 部门1管理员1      | 2020-05-12 15:04:14 | 2020-07-03 18:23:43 |
+----+------------------------------------------+--------------------+-----------------+-------------+-------------+------------+-----------------+---------------+-------------------+---------------------+---------------------+
2 rows in set (0.00 sec)
mysql>


【1】二级组织管理员,删除该组织部门
user1@email.com
{
	"dep_id":2
}
{
    "code": 0,
    "msg": "SUCCESS",
    "data": {
        "id": 2,
        "name": "信贷部",
        "organization_id": 2,
        "email": "",
        "phone": "",
        "dep_status": 2,
        "creator_id": 1,
        "desc": "",
        "created_at": "2020-07-03T17:25:55+08:00",
        "updated_at": "2020-07-03T18:43:08.2548834+08:00"
    }
}

mysql> select id,name,organization_id,dep_status from bs_department;
+----+--------------+-----------------+------------+
| id | name         | organization_id | dep_status |
+----+--------------+-----------------+------------+
|  1 | 信用卡部     |               0 |          1 |
|  2 | 信贷部       |               2 |          2 |
+----+--------------+-----------------+------------+
2 rows in set (0.00 sec)
mysql>


【2】二级组织管理员,不能删除其他组织部门
{
	"dep_id":2
}
{
    "code": 20126,
    "msg": "二级组织管理员不能删除其他组织部门; "
}



mysql> select id,name,organization_id,dep_status from bs_department;
+----+--------------+-----------------+------------+
| id | name         | organization_id | dep_status |
+----+--------------+-----------------+------------+
|  1 | 信用卡部     |               0 |          1 |
|  2 | 信贷部       |               2 |          1 |
+----+--------------+-----------------+------------+
2 rows in set (0.00 sec)

mysql> select * from bs_user_role where user_id=2;
+----+---------+---------+--------+------------+---------------------+---------------------+
| id | user_id | role_id | status | creator_id | created_at          | updated_at          |
+----+---------+---------+--------+------------+---------------------+---------------------+
|  3 |       2 |       2 |      1 |          1 | 2020-05-18 14:02:41 | 2020-05-29 11:53:46 |
+----+---------+---------+--------+------------+---------------------+---------------------+
1 row in set (0.00 sec)

mysql> select id,real_name,email,organization_id from bs_user where id=2;
+----+--------------------+-----------------+-----------------+
| id | real_name          | email           | organization_id |
+----+--------------------+-----------------+-----------------+
|  2 | 北京分行行长       | user1@email.com |               3 |
+----+--------------------+-----------------+-----------------+
1 row in set (0.00 sec)

mysql> select id,name,organization_id,dep_status from bs_department;
+----+--------------+-----------------+------------+
| id | name         | organization_id | dep_status |
+----+--------------+-----------------+------------+
|  1 | 信用卡部     |               0 |          1 |
|  2 | 信贷部       |               2 |          1 |
+----+--------------+-----------------+------------+
2 rows in set (0.00 sec)


【3】一级组织管理员,删除部门

mysql> select * from bs_user where id=1;
+----+------------------------------------------+--------------+----------------+-------------+-------------+------------+-----------------+---------------+-----------------+---------------------+---------------------+
| id | password                                 | real_name    | email          | phone       | user_status | creator_id | organization_id | department_id | desc            | created_at          | updated_at          |
+----+------------------------------------------+--------------+----------------+-------------+-------------+------------+-----------------+---------------+-----------------+---------------------+---------------------+
|  1 | 51f22a1d702815e72b593ca36de88a9c9999e57a | 总行行长     | root@email.com | 18813141001 |           1 |          0 |               1 |             0 | 系统管理员      | 2020-05-12 14:58:40 | 2020-07-02 18:07:05 |
+----+------------------------------------------+--------------+----------------+-------------+-------------+------------+-----------------+---------------+-----------------+---------------------+---------------------+
1 row in set (0.00 sec)
mysql>

mysql> select id,name,organization_id,dep_status from bs_department;
+----+--------------+-----------------+------------+
| id | name         | organization_id | dep_status |
+----+--------------+-----------------+------------+
|  1 | 信用卡部     |               0 |          1 |
|  2 | 信贷部       |               2 |          1 |
+----+--------------+-----------------+------------+
2 rows in set (0.00 sec)
mysql>


root@email.com
ca391f7a1482ed31e7341249b1c54b12
{
	"dep_id":2
}
{
    "code": 0,
    "msg": "SUCCESS",
    "data": {
        "id": 2,
        "name": "信贷部",
        "organization_id": 2,
        "email": "",
        "phone": "",
        "dep_status": 2,
        "creator_id": 1,
        "desc": "",
        "created_at": "2020-07-03T17:25:55+08:00",
        "updated_at": "2020-07-06T10:58:54.4193533+08:00"
    }
}

mysql> select id,name,organization_id,dep_status from bs_department;
+----+--------------+-----------------+------------+
| id | name         | organization_id | dep_status |
+----+--------------+-----------------+------------+
|  1 | 信用卡部     |               0 |          1 |
|  2 | 信贷部       |               2 |          2 |
+----+--------------+-----------------+------------+
2 rows in set (0.00 sec)
mysql>

