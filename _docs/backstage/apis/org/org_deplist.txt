
root
{
	"org_id":2
}
c61e15c8e8f3d034335337f1ed2bc791
{
    "code": 0,
    "msg": "SUCCESS",
    "data": {
        "list": []
    }
}

mysql> select * from bs_department;
+----+--------------+-----------------+--------------------+-------------+------------+------------+------+---------------------+---------------------+
| id | name         | organization_id | email              | phone       | dep_status | creator_id | desc | created_at          | updated_at          |
+----+--------------+-----------------+--------------------+-------------+------------+------------+------+---------------------+---------------------+
|  1 | 信用卡部     |               1 | bjfhxykb@email.com | 18800000002 |          1 |          1 |      | 2020-06-19 13:57:43 | 2020-07-08 16:26:58 |
|  2 | 信贷部       |               2 |                    |             |          2 |          1 |      | 2020-07-03 17:25:55 | 2020-07-06 10:58:54 |
+----+--------------+-----------------+--------------------+-------------+------------+------------+------+---------------------+---------------------+
2 rows in set (0.00 sec)
mysql>


{"level":"debug","msg":"sign before: POST127.0.0.1:9001/api/v1/org/deplist{\"org_id\":2}1234567890com.obencn.backstage.c27d32c5-c878-470a-8a6f-107f7d3700dd","source":"head.go:116:middleware.Options","time":"2020-07-08T16:34:04+08:00"}
{"level":"debug","msg":"server sign: c61e15c8e8f3d034335337f1ed2bc791, \tuser sign: c61e15c8e8f3d034335337f1ed2bc791","source":"context.go:161:gin.(*Context).Next","time":"2020-07-08T16:34:04+08:00"}
{"level":"debug","msg":"request uri=/api/v1/org/deplist JWT 验证token","source":"context.go:161:gin.(*Context).Next","time":"2020-07-08T16:34:04+08:00"}
{"level":"debug","msg":"request token=eyJhbGciOiJIUzI1NiIsImN0eSI6IkpXVCIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzZWNvbmRjaGFzZS5nYXRld2F5Iiwic3ViIjoiQWNjZXNzVG9rZW4iLCJhdWQiOiJodHRwczovL2JhY2tzdGFnZS5vYmVuY24uY29tIiwiZXhwIjoxNTk0Mjc3MTkzLCJuYmYiOjE1OTQxOTA0OTMsImlhdCI6MTU5NDE5MDc5MywianRpIjoiYWQ1ZGQ2NDctNTQ3NC00YWI5LTkzZmYtNDk4MDU5NDcwYzFjIiwidXNlcl9pZCI6MX0.rNBS5fyfT0h32IoFDEVwR0eWDEz6VAw_6_oK-UB01KE","source":"context.go:161:gin.(*Context).Next","time":"2020-07-08T16:34:04+08:00"}
{"level":"debug","msg":"request uri=/api/v1/org/deplist middleware Casbin 验证权限","source":"context.go:161:gin.(*Context).Next","time":"2020-07-08T16:34:04+08:00"}
2020/07/08 16:34:04 Request: 1, /api/v1/org/deplist, POST ---> true
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/user.go:24820.9427msSELECT * FROM `bs_user`  WHERE (id=?) ORDER BY `bs_user`.`id` ASC LIMIT 1[1] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-07-08T16:34:04+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/org.go:6719.9473msSELECT * FROM `bs_organization`  WHERE (id=?) ORDER BY `bs_organization`.`id` ASC LIMIT 1[1] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-07-08T16:34:04+08:00"}
{"level":"debug","msg":"orgRepo GetById orgId=1 org=\u0026{ID:1 Name:总行 Level:1 Email:zonghang@email.com Phone:18800000000 OrgStatus:1 CreatorId:1 Desc: CreatedAt:2020-06-19 13:46:13 +0800 CST UpdatedAt:2020-07-03 11:38:33 +0800 CST}","source":"org.go:154:service.(*orgService).DepList","time":"2020-07-08T16:34:04+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/org.go:6716.9542msSELECT * FROM `bs_organization`  WHERE (id=?) ORDER BY `bs_organization`.`id` ASC LIMIT 1[2] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-07-08T16:34:04+08:00"}
{"level":"debug","msg":"orgRepo GetById orgId=2 org=\u0026{ID:2 Name:北京分行 Level:2 Email:bjfh@email.com Phone:18800000001 OrgStatus:1 CreatorId:1 Desc: CreatedAt:2020-06-19 13:52:39 +0800 CST UpdatedAt:2020-07-02 16:10:39 +0800 CST}","source":"org.go:164:service.(*orgService).DepList","time":"2020-07-08T16:34:04+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/org.go:12222.9418msSELECT * FROM `bs_department`  WHERE (organization_id=? AND dep_status=?)[2 1] 0","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-07-08T16:34:04+08:00"}




mysql> update bs_department set dep_status=1 where id=2;
Query OK, 1 row affected (0.00 sec)
Rows matched: 1  Changed: 1  Warnings: 0
mysql>
mysql> select * from bs_department;
+----+--------------+-----------------+--------------------+-------------+------------+------------+------+---------------------+---------------------+
| id | name         | organization_id | email              | phone       | dep_status | creator_id | desc | created_at          | updated_at          |
+----+--------------+-----------------+--------------------+-------------+------------+------------+------+---------------------+---------------------+
|  1 | 信用卡部     |               1 | bjfhxykb@email.com | 18800000002 |          1 |          1 |      | 2020-06-19 13:57:43 | 2020-07-08 16:26:58 |
|  2 | 信贷部       |               2 |                    |             |          1 |          1 |      | 2020-07-03 17:25:55 | 2020-07-08 16:36:22 |
+----+--------------+-----------------+--------------------+-------------+------------+------------+------+---------------------+---------------------+
2 rows in set (0.00 sec)
mysql>

{
    "code": 0,
    "msg": "SUCCESS",
    "data": {
        "list": [
            {
                "id": 2,
                "name": "信贷部",
                "organization_id": 2,
                "email": "",
                "phone": "",
                "dep_status": 1,
                "creator_id": 1,
                "desc": "",
                "created_at": "2020-07-03T17:25:55+08:00",
                "updated_at": "2020-07-08T16:36:22+08:00"
            }
        ]
    }
}

{"level":"debug","msg":"sign before: POST127.0.0.1:9001/api/v1/org/deplist{\"org_id\":2}1234567890com.obencn.backstage.c27d32c5-c878-470a-8a6f-107f7d3700dd","source":"head.go:116:middleware.Options","time":"2020-07-08T16:37:35+08:00"}
{"level":"debug","msg":"server sign: c61e15c8e8f3d034335337f1ed2bc791, \tuser sign: c61e15c8e8f3d034335337f1ed2bc791","source":"context.go:161:gin.(*Context).Next","time":"2020-07-08T16:37:35+08:00"}
{"level":"debug","msg":"request uri=/api/v1/org/deplist JWT 验证token","source":"context.go:161:gin.(*Context).Next","time":"2020-07-08T16:37:35+08:00"}
{"level":"debug","msg":"request token=eyJhbGciOiJIUzI1NiIsImN0eSI6IkpXVCIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzZWNvbmRjaGFzZS5nYXRld2F5Iiwic3ViIjoiQWNjZXNzVG9rZW4iLCJhdWQiOiJodHRwczovL2JhY2tzdGFnZS5vYmVuY24uY29tIiwiZXhwIjoxNTk0Mjc3MTkzLCJuYmYiOjE1OTQxOTA0OTMsImlhdCI6MTU5NDE5MDc5MywianRpIjoiYWQ1ZGQ2NDctNTQ3NC00YWI5LTkzZmYtNDk4MDU5NDcwYzFjIiwidXNlcl9pZCI6MX0.rNBS5fyfT0h32IoFDEVwR0eWDEz6VAw_6_oK-UB01KE","source":"context.go:161:gin.(*Context).Next","time":"2020-07-08T16:37:35+08:00"}
{"level":"debug","msg":"request uri=/api/v1/org/deplist middleware Casbin 验证权限","source":"context.go:161:gin.(*Context).Next","time":"2020-07-08T16:37:35+08:00"}
2020/07/08 16:37:35 Request: 1, /api/v1/org/deplist, POST ---> true
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/user.go:24821.942msSELECT * FROM `bs_user`  WHERE (id=?) ORDER BY `bs_user`.`id` ASC LIMIT 1[1] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-07-08T16:37:35+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/org.go:6721.9411msSELECT * FROM `bs_organization`  WHERE (id=?) ORDER BY `bs_organization`.`id` ASC LIMIT 1[1] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-07-08T16:37:35+08:00"}
{"level":"debug","msg":"orgRepo GetById orgId=1 org=\u0026{ID:1 Name:总行 Level:1 Email:zonghang@email.com Phone:18800000000 OrgStatus:1 CreatorId:1 Desc: CreatedAt:2020-06-19 13:46:13 +0800 CST UpdatedAt:2020-07-03 11:38:33 +0800 CST}","source":"org.go:154:service.(*orgService).DepList","time":"2020-07-08T16:37:35+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/org.go:6717.8863msSELECT * FROM `bs_organization`  WHERE (id=?) ORDER BY `bs_organization`.`id` ASC LIMIT 1[2] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-07-08T16:37:35+08:00"}
{"level":"debug","msg":"orgRepo GetById orgId=2 org=\u0026{ID:2 Name:北京分行 Level:2 Email:bjfh@email.com Phone:18800000001 OrgStatus:1 CreatorId:1 Desc: CreatedAt:2020-06-19 13:52:39 +0800 CST UpdatedAt:2020-07-02 16:10:39 +0800 CST}","source":"org.go:164:service.(*orgService).DepList","time":"2020-07-08T16:37:35+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/org.go:12217.9516msSELECT * FROM `bs_department`  WHERE (organization_id=? AND dep_status=?)[2 1] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-07-08T16:37:35+08:00"}




admin1

mysql> select * from bs_user where id=2;
+----+------------------------------------------+--------------------+-----------------+-------------+-------------+------------+-----------------+---------------+-------------------+---------------------+---------------------+
| id | password                                 | real_name          | email           | phone       | user_status | creator_id | organization_id | department_id | desc              | created_at          | updated_at          |
+----+------------------------------------------+--------------------+-----------------+-------------+-------------+------------+-----------------+---------------+-------------------+---------------------+---------------------+
|  2 | 51f22a1d702815e72b593ca36de88a9c9999e57a | 北京分行行长       | user1@email.com | 18813141002 |           1 |          1 |               2 |             1 | 部门1管理员1      | 2020-05-12 15:04:14 | 2020-07-08 16:42:29 |
+----+------------------------------------------+--------------------+-----------------+-------------+-------------+------------+-----------------+---------------+-------------------+---------------------+---------------------+
1 row in set (0.00 sec)
mysql>


{
    "code": 0,
    "msg": "SUCCESS",
    "data": {
        "list": [
            {
                "id": 2,
                "name": "信贷部",
                "organization_id": 2,
                "email": "",
                "phone": "",
                "dep_status": 1,
                "creator_id": 1,
                "desc": "",
                "created_at": "2020-07-03T17:25:55+08:00",
                "updated_at": "2020-07-08T16:36:22+08:00"
            }
        ]
    }
}



ef93fa1866eef705b06ec169c17b54ef
{
	"org_id":3
}
{
    "code": 20127,
    "msg": "二级组织管理员不能查看其他组织部门; "
}

