
mysql> select * from bs_role_permission where role_id=4;
+----+---------+---------------+--------+------------+---------------------+---------------------+
| id | role_id | permission_id | status | creator_id | created_at          | updated_at          |
+----+---------+---------------+--------+------------+---------------------+---------------------+
| 59 |       4 |            12 |      1 |          1 | 2020-05-26 17:16:31 | 2020-05-26 17:16:31 |
| 58 |       4 |            13 |      1 |          1 | 2020-05-25 23:43:29 | 2020-05-25 23:43:29 |
+----+---------+---------------+--------+------------+---------------------+---------------------+
2 rows in set (0.00 sec)

mysql> update bs_role_permission set status=0 where role_id=4;
Query OK, 2 rows affected (0.00 sec)
Rows matched: 2  Changed: 2  Warnings: 0

mysql> select * from bs_role_permission where role_id=4;
+----+---------+---------------+--------+------------+---------------------+---------------------+
| id | role_id | permission_id | status | creator_id | created_at          | updated_at          |
+----+---------+---------------+--------+------------+---------------------+---------------------+
| 59 |       4 |            12 |      0 |          1 | 2020-05-26 17:16:31 | 2020-05-26 17:21:25 |
| 58 |       4 |            13 |      0 |          1 | 2020-05-25 23:43:29 | 2020-05-26 17:21:25 |
+----+---------+---------------+--------+------------+---------------------+---------------------+
2 rows in set (0.00 sec)

mysql>


1 root
aced0fb07cf1c95e6401ece7127d2e68
{
    "role_id":4,
    "perm_ids":[12,13,11]
}
{
    "code": 0,
    "msg": "SUCCESS"
}


{"level":"debug","msg":"sign before: POST127.0.0.1:3000/api/v1/role/permadd{\"perm_ids\":[12,13,11],\"role_id\":4}1234567890com.obencn.secondchase.3671e28d-e384-49e6-9cea-4d8cb80288d4","source":"head.go:116:middleware.Options","time":"2020-05-26T17:22:42+08:00"}
{"level":"debug","msg":"server sign: aced0fb07cf1c95e6401ece7127d2e68, \tuser sign: aced0fb07cf1c95e6401ece7127d2e68","source":"context.go:161:gin.(*Context).Next","time":"2020-05-26T17:22:42+08:00"}
{"level":"debug","msg":"request uri=/api/v1/role/permadd JWT 验证token","source":"context.go:161:gin.(*Context).Next","time":"2020-05-26T17:22:42+08:00"}
{"level":"debug","msg":"request token=eyJhbGciOiJIUzI1NiIsImN0eSI6IkpXVCIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzZWNvbmRjaGFzZS5nYXRld2F5Iiwic3ViIjoiQWNjZXNzVG9rZW4iLCJhdWQiOiJodHRwczovL2JhY2tzdGFnZS5vYmVuY24uY29tIiwiZXhwIjoxNTkwNTcwMjcxLCJuYmYiOjE1OTA0ODM1NzEsImlhdCI6MTU5MDQ4Mzg3MSwianRpIjoiNWNjNWYwMjItY2I2OS00NTVhLWFhYWQtNTBlNzA4MDQzOGYzIiwidXNlcl9pZCI6MX0.AKjF95gEEf-fIVVnLEHsKm_6Alwc5pEpQvAyqm9PuE8","source":"context.go:161:gin.(*Context).Next","time":"2020-05-26T17:22:42+08:00"}
{"level":"debug","msg":"request uri=/api/v1/role/permadd middleware Casbin 验证权限","source":"context.go:161:gin.(*Context).Next","time":"2020-05-26T17:22:42+08:00"}
{"level":"debug","msg":"roleService PermAdd req={RoleId:4 PermIds:[12 13 11]}","source":"role.go:68:handler.(*roleHandler).PermAdd.func1","time":"2020-05-26T17:22:42+08:00"}
2020/05/26 17:22:42 Request: 1, /api/v1/role/permadd, POST ---> true
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/user_role.go:6223.9363msSELECT * FROM `bs_user_role`  WHERE (status=? AND user_id=?)[1 1] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:42+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/role_permission.go:5122.9397msSELECT * FROM `bs_role_permission`  WHERE (status=? AND role_id=?)[1 1] 13","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:42+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/permission.go:6722.0996msSELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[1] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:42+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/permission.go:6723.0798msSELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[2] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:42+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/permission.go:6727.0703msSELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[3] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:42+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/permission.go:6724.9301msSELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[4] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:42+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/permission.go:6720.4652msSELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[5] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:42+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/permission.go:6724.124msSELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[6] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/permission.go:6719.1157msSELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[7] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/permission.go:6719.1852msSELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[8] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/permission.go:6720.0361msSELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[9] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/permission.go:6723.1313msSELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[10] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/permission.go:6720.3192msSELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[11] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/permission.go:6721.9331msSELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[12] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/permission.go:6720.6338msSELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[13] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"roleService PermAdd 当前操作[角色权限添加]的用户 s.UserId=1 可用权限列表 mPerms=map[1:{} 2:{} 3:{} 4:{} 5:{} 6:{} 7:{} 8:{} 9:{} 10:{} 11:{} 12:{} 13:{}]","source":"role.go:68:handler.(*roleHandler).PermAdd.func1","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"roleService PermAdd 待添加权限的角色 roleId=4 可添加权限列表 mRoleCanAddPermIds=map[11:{} 12:{} 13:{}]","source":"role.go:68:handler.(*roleHandler).PermAdd.func1","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/role_permission.go:4122.2422msSELECT * FROM `bs_role_permission`  WHERE (role_id=?)[4] 2","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"roleService PermAdd 待添加权限的角色 roleId=4 已有权限列表 rolePerms=[{ID:59 RoleId:4 PermissionId:12 Status:0 CreatorId:1 CreatedAt:2020-05-26 17:16:31 +0800 CST UpdatedAt:2020-05-26 17:21:25 +0800 CST} {ID:58 RoleId:4 PermissionId:13 Status:0 CreatorId:1 CreatedAt:2020-05-25 23:43:29 +0800 CST UpdatedAt:2020-05-26 17:21:25 +0800 CST}]","source":"role.go:68:handler.(*roleHandler).PermAdd.func1","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"roleService PermAdd 待添加权限的角色 roleId=4 可用权限列表 userNormalRoles=[]","source":"role.go:68:handler.(*roleHandler).PermAdd.func1","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"roleService PermAdd 待添加权限的角色 roleId=4 禁用权限列表 userDisabledRoles=[{ID:59 RoleId:4 PermissionId:12 Status:0 CreatorId:1 CreatedAt:2020-05-26 17:16:31 +0800 CST UpdatedAt:2020-05-26 17:21:25 +0800 CST} {ID:58 RoleId:4 PermissionId:13 Status:0 CreatorId:1 CreatedAt:2020-05-25 23:43:29 +0800 CST UpdatedAt:2020-05-26 17:21:25 +0800 CST}]","source":"role.go:68:handler.(*roleHandler).PermAdd.func1","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"roleService PermAdd 待添加权限的角色 roleId=4 最终可添加权限列表 mRoleCanAddPermIds=map[11:{} 12:{} 13:{}]","source":"role.go:68:handler.(*roleHandler).PermAdd.func1","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/role_permission.go:3621.1568msUPDATE `bs_role_permission` SET `role_id` = ?, `permission_id` = ?, `status` = ?, `creator_id` = ?, `updated_at` = ?  WHERE `bs_role_permission`.`id` = ?[4 12 1 1 2020-05-26 17:22:43.1958771 +0800 CST m=+1131.087070701 59] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/role_permission.go:3620.9449msUPDATE `bs_role_permission` SET `role_id` = ?, `permission_id` = ?, `status` = ?, `creator_id` = ?, `updated_at` = ?  WHERE `bs_role_permission`.`id` = ?[4 13 1 1 2020-05-26 17:22:43.2458569 +0800 CST m=+1131.137050501 58] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/role_permission.go:3218.3638msINSERT INTO `bs_role_permission` (`role_id`,`permission_id`,`status`,`creator_id`,`created_at`,`updated_at`) VALUES (?,?,?,?,?,?)[4 11 1 1 2020-05-26 17:22:43.2828671 +0800 CST m=+1131.174060701 2020-05-26 17:22:43.2928421 +0800 CST m=+1131.184035701] 1","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/role.go:5919.8391msSELECT * FROM `bs_role`  WHERE (role_status=?)[1] 14","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"roleRepo GetAll role_status=1 from MySQL list=[{ID:1 Name:系统管理员 RoleStatus:1 CreatorId:0 Desc: CreatedAt:2020-05-12 15:45:15 +0800 CST UpdatedAt:2020-05-14 17:41:55 +0800 CST} {ID:2 Name:子管理员1 RoleStatus:1 CreatorId:1 Desc: CreatedAt:2020-05-12 15:45:37 +0800 CST UpdatedAt:2020-05-14 17:43:02 +0800 CST} {ID:3 Name:子管理员2 RoleStatus:1 CreatorId:1 Desc: CreatedAt:2020-05-14 18:19:46 +0800 CST UpdatedAt:2020-05-14 18:19:46 +0800 CST} {ID:4 Name:子管理员3 RoleStatus:1 CreatorId:1 Desc: CreatedAt:2020-05-15 11:32:28 +0800 CST UpdatedAt:2020-05-15 11:32:28 +0800 CST} {ID:5 Name:子管理员4 RoleStatus:1 CreatorId:1 Desc: CreatedAt:2020-05-15 11:33:37 +0800 CST UpdatedAt:2020-05-15 11:33:37 +0800 CST} {ID:6 Name:子管理员5 RoleStatus:1 CreatorId:1 Desc: CreatedAt:2020-05-15 13:41:58 +0800 CST UpdatedAt:2020-05-15 13:52:21 +0800 CST} {ID:7 Name:子管理员6 RoleStatus:1 CreatorId:1 Desc:子管理员7的描述 CreatedAt:2020-05-15 14:03:07 +0800 CST UpdatedAt:2020-05-15 14:42:28 +0800 CST} {ID:8 Name:编辑1 RoleStatus:1 CreatorId:2 Desc: CreatedAt:2020-05-15 14:39:57 +0800 CST UpdatedAt:2020-05-15 14:39:57 +0800 CST} {ID:9 Name:审核1 RoleStatus:1 CreatorId:2 Desc: CreatedAt:2020-05-15 14:41:15 +0800 CST UpdatedAt:2020-05-15 14:41:15 +0800 CST} {ID:10 Name:编辑2 RoleStatus:1 CreatorId:2 Desc: CreatedAt:2020-05-18 14:02:41 +0800 CST UpdatedAt:2020-05-18 14:02:41 +0800 CST} {ID:11 Name:审核2 RoleStatus:1 CreatorId:2 Desc: CreatedAt:2020-05-18 14:20:24 +0800 CST UpdatedAt:2020-05-18 14:20:24 +0800 CST} {ID:12 Name:编辑3 RoleStatus:1 CreatorId:2 Desc: CreatedAt:2020-05-18 16:16:05 +0800 CST UpdatedAt:2020-05-18 16:16:05 +0800 CST} {ID:13 Name:审核3 RoleStatus:1 CreatorId:2 Desc: CreatedAt:2020-05-18 17:24:04 +0800 CST UpdatedAt:2020-05-18 17:24:04 +0800 CST} {ID:14 Name:编辑4 RoleStatus:1 CreatorId:2 Desc: CreatedAt:2020-05-18 18:31:28 +0800 CST UpdatedAt:2020-05-18 18:31:28 +0800 CST}]","source":"casbin_adapter.go:39:adapter.(*CasbinAdapter).loadRolePolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/permission.go:8122.171msSELECT * FROM `bs_permission`  WHERE (permission_status=?)[1] 13","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"permissionRepo GetAll permission_status=1 from MySQL list=[{ID:1 Name:权限列表 PermissionStatus:1 Method:GET Path:/api/v1/permission/list CreatorId:1 Desc: CreatedAt:2020-05-14 17:28:03 +0800 CST UpdatedAt:2020-05-14 17:36:15 +0800 CST} {ID:2 Name:创建角色 PermissionStatus:1 Method:POST Path:/api/v1/role/create CreatorId:1 Desc: CreatedAt:2020-05-14 17:29:01 +0800 CST UpdatedAt:2020-05-14 17:34:17 +0800 CST} {ID:3 Name:角色权限添加 PermissionStatus:1 Method:POST Path:/api/v1/role/permadd CreatorId:1 Desc: CreatedAt:2020-05-14 18:02:24 +0800 CST UpdatedAt:2020-05-25 16:48:18 +0800 CST} {ID:4 Name:角色权限减少 PermissionStatus:1 Method:POST Path:/api/v1/role/permreduce CreatorId:1 Desc: CreatedAt:2020-05-14 18:06:01 +0800 CST UpdatedAt:2020-05-25 16:48:09 +0800 CST} {ID:5 Name:用户角色添加 PermissionStatus:1 Method:POST Path:/api/v1/user/roleadd CreatorId:1 Desc: CreatedAt:2020-05-15 14:50:46 +0800 CST UpdatedAt:2020-05-25 16:47:49 +0800 CST} {ID:6 Name:用户角色减少 PermissionStatus:1 Method:POST Path:/api/v1/user/rolereduce CreatorId:1 Desc: CreatedAt:2020-05-15 14:51:59 +0800 CST UpdatedAt:2020-05-25 16:47:30 +0800 CST} {ID:7 Name:内容审核 PermissionStatus:1 Method:POST Path:/api/v1/content/audit CreatorId:1 Desc: CreatedAt:2020-05-15 14:53:53 +0800 CST UpdatedAt:2020-05-15 14:53:53 +0800 CST} {ID:8 Name:内容发布 PermissionStatus:1 Method:POST Path:/api/v1/content/publish CreatorId:1 Desc: CreatedAt:2020-05-15 14:55:04 +0800 CST UpdatedAt:2020-05-15 14:55:04 +0800 CST} {ID:9 Name:创建权限 PermissionStatus:1 Method:POST Path:/api/v1/permission/create CreatorId:1 Desc: CreatedAt:2020-05-15 15:06:14 +0800 CST UpdatedAt:2020-05-15 15:06:14 +0800 CST} {ID:10 Name:创建部门 PermissionStatus:1 Method:POST Path:/api/v1/department/create CreatorId:1 Desc: CreatedAt:2020-05-15 15:06:56 +0800 CST UpdatedAt:2020-05-21 13:54:13 +0800 CST} {ID:11 Name:创建用户 PermissionStatus:1 Method:POST Path:/api/v1/user/create CreatorId:1 Desc: CreatedAt:2020-05-19 15:51:52 +0800 CST UpdatedAt:2020-05-21 13:54:23 +0800 CST} {ID:12 Name:删除用户 PermissionStatus:1 Method:POST Path:/api/v1/user/delete CreatorId:1 Desc: CreatedAt:2020-05-19 17:22:07 +0800 CST UpdatedAt:2020-05-21 13:46:32 +0800 CST} {ID:13 Name:冻结用户 PermissionStatus:1 Method:POST Path:/api/v1/user/disable CreatorId:1 Desc: CreatedAt:2020-05-21 14:35:14 +0800 CST UpdatedAt:2020-05-21 14:35:14 +0800 CST}]","source":"casbin_adapter.go:47:adapter.(*CasbinAdapter).loadRolePolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/role_permission.go:6110.338msSELECT * FROM `bs_role_permission`  [] 43","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"rolePermissionRepo GetAll from MySQL list=[{ID:1 RoleId:1 PermissionId:1 Status:1 CreatorId:0 CreatedAt:2020-05-12 16:48:04 +0800 CST UpdatedAt:2020-05-12 22:55:25 +0800 CST} {ID:2 RoleId:1 PermissionId:2 Status:1 CreatorId:0 CreatedAt:2020-05-14 17:57:18 +0800 CST UpdatedAt:2020-05-14 17:57:18 +0800 CST} {ID:3 RoleId:1 PermissionId:3 Status:1 CreatorId:0 CreatedAt:2020-05-14 18:08:40 +0800 CST UpdatedAt:2020-05-14 18:08:40 +0800 CST} {ID:4 RoleId:1 PermissionId:4 Status:1 CreatorId:0 CreatedAt:2020-05-14 18:09:33 +0800 CST UpdatedAt:2020-05-14 18:09:33 +0800 CST} {ID:5 RoleId:2 PermissionId:1 Status:1 CreatorId:0 CreatedAt:2020-05-14 18:23:28 +0800 CST UpdatedAt:2020-05-14 18:23:28 +0800 CST} {ID:7 RoleId:1 PermissionId:5 Status:1 CreatorId:0 CreatedAt:2020-05-15 14:56:54 +0800 CST UpdatedAt:2020-05-15 14:56:54 +0800 CST} {ID:8 RoleId:1 PermissionId:6 Status:1 CreatorId:0 CreatedAt:2020-05-15 14:57:07 +0800 CST UpdatedAt:2020-05-15 14:57:07 +0800 CST} {ID:9 RoleId:1 PermissionId:7 Status:1 CreatorId:0 CreatedAt:2020-05-15 14:57:21 +0800 CST UpdatedAt:2020-05-15 14:57:21 +0800 CST} {ID:10 RoleId:1 PermissionId:8 Status:1 CreatorId:0 CreatedAt:2020-05-15 14:57:35 +0800 CST UpdatedAt:2020-05-15 14:57:35 +0800 CST} {ID:11 RoleId:2 PermissionId:3 Status:1 CreatorId:0 CreatedAt:2020-05-15 15:03:23 +0800 CST UpdatedAt:2020-05-15 15:03:23 +0800 CST} {ID:12 RoleId:2 PermissionId:4 Status:1 CreatorId:0 CreatedAt:2020-05-15 15:03:42 +0800 CST UpdatedAt:2020-05-15 15:03:42 +0800 CST} {ID:13 RoleId:2 PermissionId:5 Status:1 CreatorId:0 CreatedAt:2020-05-15 15:03:52 +0800 CST UpdatedAt:2020-05-15 15:03:52 +0800 CST} {ID:14 RoleId:2 PermissionId:6 Status:1 CreatorId:0 CreatedAt:2020-05-15 15:04:02 +0800 CST UpdatedAt:2020-05-15 15:04:02 +0800 CST} {ID:15 RoleId:2 PermissionId:7 Status:1 CreatorId:0 CreatedAt:2020-05-15 15:04:13 +0800 CST UpdatedAt:2020-05-15 15:04:13 +0800 CST} {ID:16 RoleId:2 PermissionId:8 Status:1 CreatorId:0 CreatedAt:2020-05-15 15:04:23 +0800 CST UpdatedAt:2020-05-15 15:04:23 +0800 CST} {ID:17 RoleId:1 PermissionId:9 Status:1 CreatorId:0 CreatedAt:2020-05-15 15:10:56 +0800 CST UpdatedAt:2020-05-15 15:10:56 +0800 CST} {ID:18 RoleId:1 PermissionId:10 Status:1 CreatorId:0 CreatedAt:2020-05-15 15:11:10 +0800 CST UpdatedAt:2020-05-15 15:11:10 +0800 CST} {ID:19 RoleId:8 PermissionId:5 Status:1 CreatorId:0 CreatedAt:2020-05-15 17:40:13 +0800 CST UpdatedAt:2020-05-15 17:40:13 +0800 CST} {ID:20 RoleId:8 PermissionId:6 Status:1 CreatorId:0 CreatedAt:2020-05-15 17:40:13 +0800 CST UpdatedAt:2020-05-15 17:40:13 +0800 CST} {ID:21 RoleId:9 PermissionId:7 Status:1 CreatorId:0 CreatedAt:2020-05-15 17:45:11 +0800 CST UpdatedAt:2020-05-15 17:45:11 +0800 CST} {ID:22 RoleId:9 PermissionId:8 Status:1 CreatorId:0 CreatedAt:2020-05-15 17:45:11 +0800 CST UpdatedAt:2020-05-15 17:45:11 +0800 CST} {ID:23 RoleId:10 PermissionId:5 Status:1 CreatorId:0 CreatedAt:2020-05-18 14:06:38 +0800 CST UpdatedAt:2020-05-18 14:06:38 +0800 CST} {ID:24 RoleId:10 PermissionId:6 Status:1 CreatorId:0 CreatedAt:2020-05-18 14:06:38 +0800 CST UpdatedAt:2020-05-18 14:06:38 +0800 CST} {ID:25 RoleId:11 PermissionId:7 Status:1 CreatorId:0 CreatedAt:2020-05-18 14:21:56 +0800 CST UpdatedAt:2020-05-18 14:21:56 +0800 CST} {ID:26 RoleId:11 PermissionId:8 Status:1 CreatorId:0 CreatedAt:2020-05-18 14:21:56 +0800 CST UpdatedAt:2020-05-18 14:21:56 +0800 CST} {ID:27 RoleId:3 PermissionId:5 Status:1 CreatorId:0 CreatedAt:2020-05-18 17:09:01 +0800 CST UpdatedAt:2020-05-18 17:09:01 +0800 CST} {ID:28 RoleId:3 PermissionId:6 Status:1 CreatorId:0 CreatedAt:2020-05-18 17:11:44 +0800 CST UpdatedAt:2020-05-18 17:11:44 +0800 CST} {ID:29 RoleId:13 PermissionId:7 Status:1 CreatorId:0 CreatedAt:2020-05-18 17:24:44 +0800 CST UpdatedAt:2020-05-18 17:24:44 +0800 CST} {ID:30 RoleId:13 PermissionId:8 Status:1 CreatorId:0 CreatedAt:2020-05-18 17:24:44 +0800 CST UpdatedAt:2020-05-18 17:24:44 +0800 CST} {ID:31 RoleId:12 PermissionId:5 Status:1 CreatorId:0 CreatedAt:2020-05-18 18:01:34 +0800 CST UpdatedAt:2020-05-18 18:01:34 +0800 CST} {ID:32 RoleId:12 PermissionId:6 Status:1 CreatorId:0 CreatedAt:2020-05-18 18:23:18 +0800 CST UpdatedAt:2020-05-18 18:23:18 +0800 CST} {ID:33 RoleId:14 PermissionId:5 Status:1 CreatorId:0 CreatedAt:2020-05-18 18:32:20 +0800 CST UpdatedAt:2020-05-18 18:32:20 +0800 CST} {ID:34 RoleId:14 PermissionId:6 Status:1 CreatorId:0 CreatedAt:2020-05-18 18:34:15 +0800 CST UpdatedAt:2020-05-18 18:34:15 +0800 CST} {ID:35 RoleId:14 PermissionId:1 Status:1 CreatorId:0 CreatedAt:2020-05-18 18:36:04 +0800 CST UpdatedAt:2020-05-18 18:36:04 +0800 CST} {ID:36 RoleId:1 PermissionId:11 Status:1 CreatorId:0 CreatedAt:2020-05-19 15:54:09 +0800 CST UpdatedAt:2020-05-19 15:54:09 +0800 CST} {ID:52 RoleId:1 PermissionId:12 Status:1 CreatorId:0 CreatedAt:2020-05-21 13:56:57 +0800 CST UpdatedAt:2020-05-21 13:56:57 +0800 CST} {ID:53 RoleId:2 PermissionId:12 Status:1 CreatorId:0 CreatedAt:2020-05-21 13:57:11 +0800 CST UpdatedAt:2020-05-21 13:57:11 +0800 CST} {ID:54 RoleId:2 PermissionId:11 Status:1 CreatorId:0 CreatedAt:2020-05-21 14:01:02 +0800 CST UpdatedAt:2020-05-21 14:01:02 +0800 CST} {ID:55 RoleId:1 PermissionId:13 Status:1 CreatorId:0 CreatedAt:2020-05-21 14:37:19 +0800 CST UpdatedAt:2020-05-21 14:37:20 +0800 CST} {ID:56 RoleId:2 PermissionId:13 Status:1 CreatorId:0 CreatedAt:2020-05-21 14:37:30 +0800 CST UpdatedAt:2020-05-21 14:37:30 +0800 CST} {ID:58 RoleId:4 PermissionId:13 Status:1 CreatorId:1 CreatedAt:2020-05-25 23:43:29 +0800 CST UpdatedAt:2020-05-26 17:22:43 +0800 CST} {ID:59 RoleId:4 PermissionId:12 Status:1 CreatorId:1 CreatedAt:2020-05-26 17:16:31 +0800 CST UpdatedAt:2020-05-26 17:22:43 +0800 CST} {ID:60 RoleId:4 PermissionId:11 Status:1 CreatorId:1 CreatedAt:2020-05-26 17:22:43 +0800 CST UpdatedAt:2020-05-26 17:22:43 +0800 CST}]","source":"casbin_adapter.go:56:adapter.(*CasbinAdapter).loadRolePolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,1,/api/v1/permission/list,GET","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,1,/api/v1/role/create,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,1,/api/v1/role/permadd,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,1,/api/v1/role/permreduce,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,1,/api/v1/user/roleadd,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,1,/api/v1/user/rolereduce,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,1,/api/v1/content/audit,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,1,/api/v1/content/publish,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,1,/api/v1/permission/create,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,1,/api/v1/department/create,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,1,/api/v1/user/create,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,1,/api/v1/user/delete,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,1,/api/v1/user/disable,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,2,/api/v1/permission/list,GET","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,2,/api/v1/role/permadd,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,2,/api/v1/role/permreduce,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,2,/api/v1/user/roleadd,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,2,/api/v1/user/rolereduce,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,2,/api/v1/content/audit,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,2,/api/v1/content/publish,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,2,/api/v1/user/delete,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,2,/api/v1/user/create,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,2,/api/v1/user/disable,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,3,/api/v1/user/roleadd,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,3,/api/v1/user/rolereduce,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,4,/api/v1/user/disable,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,4,/api/v1/user/delete,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,4,/api/v1/user/create,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,8,/api/v1/user/roleadd,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,8,/api/v1/user/rolereduce,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,9,/api/v1/content/audit,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,9,/api/v1/content/publish,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,10,/api/v1/user/roleadd,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,10,/api/v1/user/rolereduce,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,11,/api/v1/content/audit,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,11,/api/v1/content/publish,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,12,/api/v1/user/roleadd,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,12,/api/v1/user/rolereduce,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,13,/api/v1/content/audit,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,13,/api/v1/content/publish,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,14,/api/v1/user/roleadd,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,14,/api/v1/user/rolereduce,POST","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadRolePolicy line=p,14,/api/v1/permission/list,GET","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"CasbinAdapter loadRolePolicy casbinModel.Model m=map[e:map[e:0xc00004e540] g:map[g:0xc00004e480] m:map[m:0xc00004e600] p:map[p:0xc00004e420] r:map[r:0xc00004e6c0]]","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"CasbinAdapter loadRolePolicy casbinModel.Model m[e][e]=\u0026{Key:e Value:some(where (p_eft == allow)) Tokens:[] Policy:[] RM:\u003cnil\u003e}","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"CasbinAdapter loadRolePolicy casbinModel.Model m[g][g]=\u0026{Key:e Value:some(where (p_eft == allow)) Tokens:[] Policy:[] RM:\u003cnil\u003e}","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"CasbinAdapter loadRolePolicy casbinModel.Model m[m][m]=\u0026{Key:m Value:g(r_sub, p_sub) \u0026\u0026 keyMatch2(r_obj, p_obj) \u0026\u0026 r_act == p_act Tokens:[] Policy:[] RM:\u003cnil\u003e}","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"CasbinAdapter loadRolePolicy casbinModel.Model m[p][p]=\u0026{Key:p Value:sub, obj, act Tokens:[p_sub p_obj p_act] Policy:[[1 /api/v1/permission/list GET] [1 /api/v1/role/create POST] [1 /api/v1/role/permadd POST] [1 /api/v1/role/permreduce POST] [1 /api/v1/user/roleadd POST] [1 /api/v1/user/rolereduce POST] [1 /api/v1/content/audit POST] [1 /api/v1/content/publish POST] [1 /api/v1/permission/create POST] [1 /api/v1/department/create POST] [1 /api/v1/user/create POST] [1 /api/v1/user/delete POST] [1 /api/v1/user/disable POST] [2 /api/v1/permission/list GET] [2 /api/v1/role/permadd POST] [2 /api/v1/role/permreduce POST] [2 /api/v1/user/roleadd POST] [2 /api/v1/user/rolereduce POST] [2 /api/v1/content/audit POST] [2 /api/v1/content/publish POST] [2 /api/v1/user/delete POST] [2 /api/v1/user/create POST] [2 /api/v1/user/disable POST] [3 /api/v1/user/roleadd POST] [3 /api/v1/user/rolereduce POST] [4 /api/v1/user/disable POST] [4 /api/v1/user/delete POST] [4 /api/v1/user/create POST] [8 /api/v1/user/roleadd POST] [8 /api/v1/user/rolereduce POST] [9 /api/v1/content/audit POST] [9 /api/v1/content/publish POST] [10 /api/v1/user/roleadd POST] [10 /api/v1/user/rolereduce POST] [11 /api/v1/content/audit POST] [11 /api/v1/content/publish POST] [12 /api/v1/user/roleadd POST] [12 /api/v1/user/rolereduce POST] [13 /api/v1/content/audit POST] [13 /api/v1/content/publish POST] [14 /api/v1/user/roleadd POST] [14 /api/v1/user/rolereduce POST] [14 /api/v1/permission/list GET]] RM:\u003cnil\u003e}","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"CasbinAdapter loadRolePolicy casbinModel.Model m[r][r]=\u0026{Key:r Value:sub, obj, act Tokens:[r_sub r_obj r_act] Policy:[] RM:\u003cnil\u003e}","source":"casbin_adapter.go:25:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/user.go:17020.7735msSELECT * FROM `bs_user`  WHERE (user_status=?)[1] 9","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"userRepo GetAll user_status=1 from MySQL list=[{ID:1 DepartmentId:0 Name:root Password:d6cf393ff29f1b223052a63891ef52bca7697e85 RealName:超级管理员 Email:root@email.com Phone:18813141001 UserStatus:1 CreatorId:0 Desc:最高权限用户 CreatedAt:2020-05-12 14:58:40 +0800 CST UpdatedAt:2020-05-20 13:37:36 +0800 CST} {ID:2 DepartmentId:1 Name:user1 Password:d6cf393ff29f1b223052a63891ef52bca7697e85 RealName:管理员1 Email:user1@email.com Phone:18813141002 UserStatus:1 CreatorId:1 Desc:普通权限用户1 CreatedAt:2020-05-12 15:04:14 +0800 CST UpdatedAt:2020-05-20 13:37:36 +0800 CST} {ID:3 DepartmentId:1 Name:user2 Password:d6cf393ff29f1b223052a63891ef52bca7697e85 RealName:管理员2 Email:user2@email.com Phone:18813141003 UserStatus:1 CreatorId:1 Desc:普通权限用户2 CreatedAt:2020-05-18 11:28:29 +0800 CST UpdatedAt:2020-05-20 13:37:36 +0800 CST} {ID:4 DepartmentId:1 Name:user3 Password:d6cf393ff29f1b223052a63891ef52bca7697e85 RealName:管理员3 Email:user3@email.com Phone:18813141004 UserStatus:1 CreatorId:1 Desc:普通权限用户3 CreatedAt:2020-05-18 14:17:39 +0800 CST UpdatedAt:2020-05-20 13:37:36 +0800 CST} {ID:5 DepartmentId:1 Name:user4 Password:d6cf393ff29f1b223052a63891ef52bca7697e85 RealName:管理员4 Email:user4@email.com Phone:18813141005 UserStatus:1 CreatorId:1 Desc:普通权限用户4 CreatedAt:2020-05-18 17:22:38 +0800 CST UpdatedAt:2020-05-20 13:37:36 +0800 CST} {ID:6 DepartmentId:1 Name:user5 Password:d6cf393ff29f1b223052a63891ef52bca7697e85 RealName:管理员5 Email:user5@email.com Phone:18813141006 UserStatus:1 CreatorId:1 Desc:普通权限用户5 CreatedAt:2020-05-18 18:28:59 +0800 CST UpdatedAt:2020-05-20 13:37:36 +0800 CST} {ID:7 DepartmentId:1 Name:user6 Password:d6cf393ff29f1b223052a63891ef52bca7697e85 RealName:管理员6 Email:user6@email.com Phone:18813141007 UserStatus:1 CreatorId:1 Desc:普通权限用户6 CreatedAt:2020-05-19 17:10:16 +0800 CST UpdatedAt:2020-05-20 16:05:08 +0800 CST} {ID:10 DepartmentId:1 Name:user9new Password:2ceaf92638986db196e4973e718b58c19bda80df RealName:姓名9new Email:user9@email.com Phone:18800000009 UserStatus:1 CreatorId:2 Desc:备注描述9 CreatedAt:2020-05-20 16:57:16 +0800 CST UpdatedAt:2020-05-21 16:15:17 +0800 CST} {ID:11 DepartmentId:1 Name:user10 Password:d6cf393ff29f1b223052a63891ef52bca7697e85 RealName:姓名10 Email:user10@email.com Phone:18800000010 UserStatus:1 CreatorId:2 Desc:备注描述10 CreatedAt:2020-05-22 17:03:35 +0800 CST UpdatedAt:2020-05-22 17:03:36 +0800 CST}]","source":"casbin_adapter.go:98:adapter.(*CasbinAdapter).loadUserPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/user_role.go:4110.2368msSELECT * FROM `bs_user_role`  [] 18","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"userRoleRepo GetAll from MySQL list=[{ID:1 UserId:1 RoleId:1 Status:1 CreatorId:0 CreatedAt:2020-05-12 16:34:10 +0800 CST UpdatedAt:2020-05-14 18:24:07 +0800 CST} {ID:2 UserId:2 RoleId:2 Status:1 CreatorId:0 CreatedAt:2020-05-14 15:29:22 +0800 CST UpdatedAt:2020-05-14 18:24:37 +0800 CST} {ID:3 UserId:2 RoleId:10 Status:1 CreatorId:0 CreatedAt:2020-05-18 14:02:41 +0800 CST UpdatedAt:2020-05-18 14:02:41 +0800 CST} {ID:4 UserId:3 RoleId:10 Status:1 CreatorId:0 CreatedAt:2020-05-18 14:09:40 +0800 CST UpdatedAt:2020-05-18 14:09:40 +0800 CST} {ID:5 UserId:2 RoleId:11 Status:1 CreatorId:0 CreatedAt:2020-05-18 14:20:24 +0800 CST UpdatedAt:2020-05-18 14:20:24 +0800 CST} {ID:6 UserId:4 RoleId:11 Status:1 CreatorId:0 CreatedAt:2020-05-18 14:23:15 +0800 CST UpdatedAt:2020-05-18 14:23:15 +0800 CST} {ID:7 UserId:2 RoleId:12 Status:1 CreatorId:0 CreatedAt:2020-05-18 16:16:05 +0800 CST UpdatedAt:2020-05-18 16:16:05 +0800 CST} {ID:8 UserId:2 RoleId:13 Status:1 CreatorId:0 CreatedAt:2020-05-18 17:24:04 +0800 CST UpdatedAt:2020-05-18 17:24:04 +0800 CST} {ID:9 UserId:5 RoleId:13 Status:1 CreatorId:0 CreatedAt:2020-05-18 17:27:38 +0800 CST UpdatedAt:2020-05-18 17:27:38 +0800 CST} {ID:10 UserId:5 RoleId:12 Status:1 CreatorId:0 CreatedAt:2020-05-18 18:04:01 +0800 CST UpdatedAt:2020-05-18 18:04:01 +0800 CST} {ID:11 UserId:2 RoleId:14 Status:1 CreatorId:0 CreatedAt:2020-05-18 18:31:28 +0800 CST UpdatedAt:2020-05-18 18:31:28 +0800 CST} {ID:12 UserId:6 RoleId:14 Status:1 CreatorId:0 CreatedAt:2020-05-18 18:32:52 +0800 CST UpdatedAt:2020-05-18 18:32:52 +0800 CST} {ID:13 UserId:11 RoleId:10 Status:1 CreatorId:0 CreatedAt:2020-05-22 17:38:17 +0800 CST UpdatedAt:2020-05-22 17:38:17 +0800 CST} {ID:14 UserId:0 RoleId:0 Status:1 CreatorId:2 CreatedAt:2020-05-25 14:39:35 +0800 CST UpdatedAt:2020-05-25 14:46:56 +0800 CST} {ID:15 UserId:7 RoleId:10 Status:1 CreatorId:2 CreatedAt:2020-05-25 14:48:22 +0800 CST UpdatedAt:2020-05-25 14:48:22 +0800 CST} {ID:16 UserId:8 RoleId:10 Status:0 CreatorId:2 CreatedAt:2020-05-25 14:53:23 +0800 CST UpdatedAt:2020-05-25 17:29:04 +0800 CST} {ID:17 UserId:0 RoleId:0 Status:1 CreatorId:2 CreatedAt:2020-05-25 15:10:28 +0800 CST UpdatedAt:2020-05-25 15:18:29 +0800 CST} {ID:18 UserId:8 RoleId:11 Status:0 CreatorId:2 CreatedAt:2020-05-25 15:27:46 +0800 CST UpdatedAt:2020-05-25 17:29:04 +0800 CST}]","source":"casbin_adapter.go:106:adapter.(*CasbinAdapter).loadUserPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy line=g,1,1","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy line=g,2,2","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy line=g,2,10","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy line=g,2,11","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy line=g,2,12","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy line=g,2,13","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy line=g,2,14","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy line=g,3,10","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy line=g,4,11","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy line=g,5,13","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy line=g,5,12","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy line=g,6,14","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy line=g,7,10","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy line=g,11,10","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy casbinModel.Model m=map[e:map[e:0xc00004e540] g:map[g:0xc00004e480] m:map[m:0xc00004e600] p:map[p:0xc00004e420] r:map[r:0xc00004e6c0]]","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy casbinModel.Model m[e][e]=\u0026{Key:e Value:some(where (p_eft == allow)) Tokens:[] Policy:[] RM:\u003cnil\u003e}","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy casbinModel.Model m[g][g]=\u0026{Key:g Value:_, _ Tokens:[] Policy:[[1 1] [2 2] [2 10] [2 11] [2 12] [2 13] [2 14] [3 10] [4 11] [5 13] [5 12] [6 14] [7 10] [11 10]] RM:0xc000004380}","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy casbinModel.Model m[m][m]=\u0026{Key:m Value:g(r_sub, p_sub) \u0026\u0026 keyMatch2(r_obj, p_obj) \u0026\u0026 r_act == p_act Tokens:[] Policy:[] RM:\u003cnil\u003e}","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy casbinModel.Model m[p][p]=\u0026{Key:p Value:sub, obj, act Tokens:[p_sub p_obj p_act] Policy:[[1 /api/v1/permission/list GET] [1 /api/v1/role/create POST] [1 /api/v1/role/permadd POST] [1 /api/v1/role/permreduce POST] [1 /api/v1/user/roleadd POST] [1 /api/v1/user/rolereduce POST] [1 /api/v1/content/audit POST] [1 /api/v1/content/publish POST] [1 /api/v1/permission/create POST] [1 /api/v1/department/create POST] [1 /api/v1/user/create POST] [1 /api/v1/user/delete POST] [1 /api/v1/user/disable POST] [2 /api/v1/permission/list GET] [2 /api/v1/role/permadd POST] [2 /api/v1/role/permreduce POST] [2 /api/v1/user/roleadd POST] [2 /api/v1/user/rolereduce POST] [2 /api/v1/content/audit POST] [2 /api/v1/content/publish POST] [2 /api/v1/user/delete POST] [2 /api/v1/user/create POST] [2 /api/v1/user/disable POST] [3 /api/v1/user/roleadd POST] [3 /api/v1/user/rolereduce POST] [4 /api/v1/user/disable POST] [4 /api/v1/user/delete POST] [4 /api/v1/user/create POST] [8 /api/v1/user/roleadd POST] [8 /api/v1/user/rolereduce POST] [9 /api/v1/content/audit POST] [9 /api/v1/content/publish POST] [10 /api/v1/user/roleadd POST] [10 /api/v1/user/rolereduce POST] [11 /api/v1/content/audit POST] [11 /api/v1/content/publish POST] [12 /api/v1/user/roleadd POST] [12 /api/v1/user/rolereduce POST] [13 /api/v1/content/audit POST] [13 /api/v1/content/publish POST] [14 /api/v1/user/roleadd POST] [14 /api/v1/user/rolereduce POST] [14 /api/v1/permission/list GET]] RM:\u003cnil\u003e}","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
{"level":"debug","msg":"CasbinAdapter loadUserPolicy casbinModel.Model m[r][r]=\u0026{Key:r Value:sub, obj, act Tokens:[r_sub r_obj r_act] Policy:[] RM:\u003cnil\u003e}","source":"casbin_adapter.go:29:adapter.(*CasbinAdapter).LoadPolicy","time":"2020-05-26T17:22:43+08:00"}
2020/05/26 17:22:43 Policy:
2020/05/26 17:22:43 p: sub, obj, act: [[1 /api/v1/permission/list GET] [1 /api/v1/role/create POST] [1 /api/v1/role/permadd POST] [1 /api/v1/role/permreduce POST] [1 /api/v1/user/roleadd POST] [1 /api/v1/user/rolereduce POST] [1 /api/v1/content/audit POST] [1 /api/v1/content/publish POST] [1 /api/v1/permission/create POST] [1 /api/v1/department/create POST] [1 /api/v1/user/create POST] [1 /api/v1/user/delete POST] [1 /api/v1/user/disable POST] [2 /api/v1/permission/list GET] [2 /api/v1/role/permadd POST] [2 /api/v1/role/permreduce POST] [2 /api/v1/user/roleadd POST] [2 /api/v1/user/rolereduce POST] [2 /api/v1/content/audit POST] [2 /api/v1/content/publish POST] [2 /api/v1/user/delete POST] [2 /api/v1/user/create POST] [2 /api/v1/user/disable POST] [3 /api/v1/user/roleadd POST] [3 /api/v1/user/rolereduce POST] [4 /api/v1/user/disable POST] [4 /api/v1/user/delete POST] [4 /api/v1/user/create POST] [8 /api/v1/user/roleadd POST] [8 /api/v1/user/rolereduce POST] [9 /api/v1/content/audit POST] [9 /api/v1/content/publish POST] [10 /api/v1/user/roleadd POST] [10 /api/v1/user/rolereduce POST] [11 /api/v1/content/audit POST] [11 /api/v1/content/publish POST] [12 /api/v1/user/roleadd POST] [12 /api/v1/user/rolereduce POST] [13 /api/v1/content/audit POST] [13 /api/v1/content/publish POST] [14 /api/v1/user/roleadd POST] [14 /api/v1/user/rolereduce POST] [14 /api/v1/permission/list GET]]
2020/05/26 17:22:43 g: _, _: [[1 1] [2 2] [2 10] [2 11] [2 12] [2 13] [2 14] [3 10] [4 11] [5 13] [5 12] [6 14] [7 10] [11 10]]
2020/05/26 17:22:43 Role links for: g
2020/05/26 17:22:43 4 < 11, 6 < 14, 7 < 10, 1 < 1, 11 < 10, 5 < (13, 12), 2 < (2, 10, 11, 12, 13, 14), 3 < 10




mysql> select * from bs_role_permission where role_id=4;
+----+---------+---------------+--------+------------+---------------------+---------------------+
| id | role_id | permission_id | status | creator_id | created_at          | updated_at          |
+----+---------+---------------+--------+------------+---------------------+---------------------+
| 59 |       4 |            12 |      0 |          1 | 2020-05-26 17:16:31 | 2020-05-26 17:21:25 |
| 58 |       4 |            13 |      0 |          1 | 2020-05-25 23:43:29 | 2020-05-26 17:21:25 |
+----+---------+---------------+--------+------------+---------------------+---------------------+
2 rows in set (0.00 sec)

mysql>
mysql> select * from bs_role_permission where role_id=4;
+----+---------+---------------+--------+------------+---------------------+---------------------+
| id | role_id | permission_id | status | creator_id | created_at          | updated_at          |
+----+---------+---------------+--------+------------+---------------------+---------------------+
| 60 |       4 |            11 |      1 |          1 | 2020-05-26 17:22:43 | 2020-05-26 17:22:43 |
| 59 |       4 |            12 |      1 |          1 | 2020-05-26 17:16:31 | 2020-05-26 17:22:43 |
| 58 |       4 |            13 |      1 |          1 | 2020-05-25 23:43:29 | 2020-05-26 17:22:43 |
+----+---------+---------------+--------+------------+---------------------+---------------------+
3 rows in set (0.00 sec)

mysql>



roleService PermAdd req={RoleId:4 PermIds:[12 13 11]}
2020/05/26 17:22:42 Request: 1, /api/v1/role/permadd, POST ---> true

SELECT * FROM `bs_user_role`  WHERE (status=? AND user_id=?)[1 1] 1

SELECT * FROM `bs_role_permission`  WHERE (status=? AND role_id=?)[1 1] 13

SELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[1] 1
SELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[2] 1
SELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[3] 1
SELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[4] 1
SELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[5] 1
SELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[6] 1
SELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[7] 1
SELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[8] 1
SELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[9] 1
SELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[10] 1
SELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[11] 1
SELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[12] 1
SELECT * FROM `bs_permission`  WHERE (id=?) ORDER BY `bs_permission`.`id` ASC LIMIT 1[13] 1


roleService PermAdd 当前操作[角色权限添加]的用户 s.UserId=1 可用权限列表 mPerms=map[1:{} 2:{} 3:{} 4:{} 5:{} 6:{} 7:{} 8:{} 9:{} 10:{} 11:{} 12:{} 13:{}]

roleService PermAdd 待添加权限的角色 roleId=4 可添加权限列表 mRoleCanAddPermIds=map[11:{} 12:{} 13:{}]

SELECT * FROM `bs_role_permission`  WHERE (role_id=?)[4] 2
roleService PermAdd 待添加权限的角色 roleId=4 已有权限列表 rolePerms=[
    {ID:59 RoleId:4 PermissionId:12 Status:0 CreatorId:1 CreatedAt:2020-05-26 17:16:31 +0800 CST UpdatedAt:2020-05-26 17:21:25 +0800 CST}
    {ID:58 RoleId:4 PermissionId:13 Status:0 CreatorId:1 CreatedAt:2020-05-25 23:43:29 +0800 CST UpdatedAt:2020-05-26 17:21:25 +0800 CST}
]
roleService PermAdd 待添加权限的角色 roleId=4 可用权限列表 userNormalRoles=[]
roleService PermAdd 待添加权限的角色 roleId=4 禁用权限列表 userDisabledRoles=[
    {ID:59 RoleId:4 PermissionId:12 Status:0 CreatorId:1 CreatedAt:2020-05-26 17:16:31 +0800 CST UpdatedAt:2020-05-26 17:21:25 +0800 CST}
    {ID:58 RoleId:4 PermissionId:13 Status:0 CreatorId:1 CreatedAt:2020-05-25 23:43:29 +0800 CST UpdatedAt:2020-05-26 17:21:25 +0800 CST}
]
roleService PermAdd 待添加权限的角色 roleId=4 最终可添加权限列表 mRoleCanAddPermIds=map[11:{} 12:{} 13:{}]

UPDATE `bs_role_permission` SET `role_id` = ?, `permission_id` = ?, `status` = ?, `creator_id` = ?, `updated_at` = ?  WHERE `bs_role_permission`.`id` = ?
[4 12 1 1 2020-05-26 17:22:43.1958771 +0800 CST m=+1131.087070701 59] 1

UPDATE `bs_role_permission` SET `role_id` = ?, `permission_id` = ?, `status` = ?, `creator_id` = ?, `updated_at` = ?  WHERE `bs_role_permission`.`id` = ?
[4 13 1 1 2020-05-26 17:22:43.2458569 +0800 CST m=+1131.137050501 58] 1

INSERT INTO `bs_role_permission` (`role_id`,`permission_id`,`status`,`creator_id`,`created_at`,`updated_at`) VALUES (?,?,?,?,?,?)
[4 11 1 1 2020-05-26 17:22:43.2828671 +0800 CST m=+1131.174060701 2020-05-26 17:22:43.2928421 +0800 CST m=+1131.184035701] 1
