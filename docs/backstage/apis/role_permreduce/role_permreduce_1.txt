

mysql> select * from bs_role_permission where role_id=4;
+----+---------+---------------+--------+------------+---------------------+---------------------+
| id | role_id | permission_id | status | creator_id | created_at          | updated_at          |
+----+---------+---------------+--------+------------+---------------------+---------------------+
| 60 |       4 |            11 |      1 |          1 | 2020-05-26 17:22:43 | 2020-05-26 17:22:43 |
| 59 |       4 |            12 |      1 |          1 | 2020-05-26 17:16:31 | 2020-05-26 17:22:43 |
| 58 |       4 |            13 |      1 |          1 | 2020-05-25 23:43:29 | 2020-05-26 17:22:43 |
+----+---------+---------------+--------+------------+---------------------+---------------------+
3 rows in set (0.00 sec)
mysql>

1 root
acd73eafe9dacdbbc0b97f98a1a448b6
{
    "role_id":4,
    "perm_ids":[10]
}
{
    "code": 0,
    "msg": "SUCCESS"
}

{"level":"debug","msg":"sign before: POST127.0.0.1:3000/api/v1/role/permreduce{\"perm_ids\":[10],\"role_id\":4}1234567890com.obencn.secondchase.3671e28d-e384-49e6-9cea-4d8cb80288d4","source":"head.go:116:middleware.Options","time":"2020-05-27T14:16:22+08:00"}
{"level":"debug","msg":"server sign: acd73eafe9dacdbbc0b97f98a1a448b6, \tuser sign: acd73eafe9dacdbbc0b97f98a1a448b6","source":"context.go:161:gin.(*Context).Next","time":"2020-05-27T14:16:22+08:00"}
{"level":"debug","msg":"request uri=/api/v1/role/permreduce JWT 验证token","source":"context.go:161:gin.(*Context).Next","time":"2020-05-27T14:16:22+08:00"}
{"level":"debug","msg":"request token=eyJhbGciOiJIUzI1NiIsImN0eSI6IkpXVCIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzZWNvbmRjaGFzZS5nYXRld2F5Iiwic3ViIjoiQWNjZXNzVG9rZW4iLCJhdWQiOiJodHRwczovL2JhY2tzdGFnZS5vYmVuY24uY29tIiwiZXhwIjoxNTkwNjQ2MzQ4LCJuYmYiOjE1OTA1NTk2NDgsImlhdCI6MTU5MDU1OTk0OCwianRpIjoiNDRkMGQ4ZjctZTE0Zi00ODY1LWFjZTQtNDRmMTk5YTYzMDZkIiwidXNlcl9pZCI6MX0.VvhoN_YWOTR-X6rbhPeQOvF70AiqBrUIJrTGJzXtuYk","source":"context.go:161:gin.(*Context).Next","time":"2020-05-27T14:16:22+08:00"}
{"level":"debug","msg":"request uri=/api/v1/role/permreduce middleware Casbin 验证权限","source":"context.go:161:gin.(*Context).Next","time":"2020-05-27T14:16:22+08:00"}
{"level":"debug","msg":"roleService PermReduce req={RoleId:4 PermIds:[10]}","source":"role.go:105:handler.(*roleHandler).PermReduce.func1","time":"2020-05-27T14:16:22+08:00"}
2020/05/27 14:16:22 Request: 1, /api/v1/role/permreduce, POST ---> true
{"level":"info","msg":"sqlC:/oben/project/backstage/repository/role_permission.go:5222.9396msSELECT * FROM `bs_role_permission`  WHERE (status=? AND role_id=?)[1 4] 3","source":"scope.go:1047:gorm.(*Scope).trace","time":"2020-05-27T14:16:22+08:00"}
{"level":"debug","msg":"roleService PermReduce 待减少权限的角色 roleId=4 可用权限列表 mRoleNormalPerms=map[11:{} 12:{} 13:{}]","source":"role.go:105:handler.(*roleHandler).PermReduce.func1","time":"2020-05-27T14:16:22+08:00"}
{"level":"debug","msg":"roleService PermReduce 待减少权限的角色 roleId=4 可减少权限列表 mRoleCanReducePermIds=map[]","source":"role.go:105:handler.(*roleHandler).PermReduce.func1","time":"2020-05-27T14:16:22+08:00"}


mysql> select * from bs_role_permission where role_id=4;
+----+---------+---------------+--------+------------+---------------------+---------------------+
| id | role_id | permission_id | status | creator_id | created_at          | updated_at          |
+----+---------+---------------+--------+------------+---------------------+---------------------+
| 60 |       4 |            11 |      1 |          1 | 2020-05-26 17:22:43 | 2020-05-26 17:22:43 |
| 59 |       4 |            12 |      1 |          1 | 2020-05-26 17:16:31 | 2020-05-26 17:22:43 |
| 58 |       4 |            13 |      1 |          1 | 2020-05-25 23:43:29 | 2020-05-26 17:22:43 |
+----+---------+---------------+--------+------------+---------------------+---------------------+
3 rows in set (0.00 sec)
mysql>



roleService PermReduce req={RoleId:4 PermIds:[10]}
2020/05/27 14:16:22 Request: 1, /api/v1/role/permreduce, POST ---> true
SELECT * FROM `bs_role_permission`  WHERE (status=? AND role_id=?)[1 4] 3
roleService PermReduce 待减少权限的角色 roleId=4 可用权限列表 mRoleNormalPerms=map[11:{} 12:{} 13:{}]
roleService PermReduce 待减少权限的角色 roleId=4 可减少权限列表 mRoleCanReducePermIds=map[]

